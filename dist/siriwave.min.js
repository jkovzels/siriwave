!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Siriwave={})}(this,function(t){"use strict";function d(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function s(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function i(t,e,i){return e&&s(t.prototype,e),i&&s(t,i),t}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};for(var n,r=(function(o){(function(){var t,e,i,s,n,r;"undefined"!=typeof performance&&null!==performance&&performance.now?o.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(o.exports=function(){return(t()-n)/1e6},e=process.hrtime,s=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),r=1e9*process.uptime(),n=s-r):i=Date.now?(o.exports=function(){return Date.now()-i},Date.now()):(o.exports=function(){return(new Date).getTime()-i},(new Date).getTime())}).call(e)}(n={exports:{}},n.exports),n.exports),o="undefined"==typeof window?e:window,a=["moz","webkit"],h="AnimationFrame",l=o["request"+h],u=o["cancel"+h]||o["cancelRequest"+h],f=0;!l&&f<a.length;f++)l=o[a[f]+"Request"+h],u=o[a[f]+"Cancel"+h]||o[a[f]+"CancelRequest"+h];if(!l||!u){var p=0,c=0,v=[];l=function(t){if(0===v.length){var e=r(),i=Math.max(0,1e3/60-(e-p));p=i+e,setTimeout(function(){for(var t=v.slice(0),e=v.length=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(p)}catch(t){setTimeout(function(){throw t},0)}},Math.round(i))}return v.push({handle:++c,callback:t,cancelled:!1}),c},u=function(t){for(var e=0;e<v.length;e++)v[e].handle===t&&(v[e].cancelled=!0)}}var y=function(t){return l.call(o,t)};y.cancel=function(){u.apply(o,arguments)},y.polyfill=function(t){t||(t=o),t.requestAnimationFrame=l,t.cancelAnimationFrame=u};var m=function(t,e,i){return t*(1-i)+e*i},w=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};d(this,e),this.controller=t.ctrl,this.speed=t,this.xOffset=t.ctrl.xOffset,this.yOffset=t.ctrl.yOffset,this.height=t.ctrl.height,this.width=t.ctrl.width,this.midLine=this.yOffset+this.height/2,this.definition=t.definition,this.pixelDepth=t.pixelDepth,this.AMPLITUDE_FACTOR=.8,this.GRAPH_X=25,this.SPEED_FACTOR=1,this.DEAD_PX=2,this.ATT_FACTOR=4,this.DESPAWN_FACTOR=.02,this.NOOFCURVES_RANGES=[2,5],this.AMPLITUDE_RANGES=[.3,1],this.OFFSET_RANGES=[-3,3],this.WIDTH_RANGES=[1,3],this.SPEED_RANGES=[.5,1],this.DESPAWN_TIMEOUT_RANGES=[500,2e3],this.respawn()}return i(e,[{key:"getRandomRange",value:function(t){return t[0]+Math.random()*(t[1]-t[0])}},{key:"respawnSingle",value:function(t){this.phases[t]=0,this.amplitudes[t]=0,this.despawnTimeouts[t]=this.getRandomRange(this.DESPAWN_TIMEOUT_RANGES),this.offsets[t]=this.getRandomRange(this.OFFSET_RANGES),this.speeds[t]=this.getRandomRange(this.SPEED_RANGES),this.finalAmplitudes[t]=this.getRandomRange(this.AMPLITUDE_RANGES),this.widths[t]=this.getRandomRange(this.WIDTH_RANGES),this.verses[t]=this.getRandomRange([-1,1])}},{key:"respawn",value:function(){this.spawnAt=Date.now(),this.noOfCurves=Math.floor(this.getRandomRange(this.NOOFCURVES_RANGES)),this.phases=new Array(this.noOfCurves),this.offsets=new Array(this.noOfCurves),this.speeds=new Array(this.noOfCurves),this.finalAmplitudes=new Array(this.noOfCurves),this.widths=new Array(this.noOfCurves),this.amplitudes=new Array(this.noOfCurves),this.despawnTimeouts=new Array(this.noOfCurves),this.verses=new Array(this.noOfCurves);for(var t=0;t<this.noOfCurves;t++)this.respawnSingle(t)}},{key:"globalAttFn",value:function(t){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(t,2)),this.ATT_FACTOR)}},{key:"yRelativePos",value:function(t){for(var e=0,i=0;i<this.noOfCurves;i++){var s=4*(i/(this.noOfCurves-1)*2-1);s+=this.offsets[i];var n=t*(1/this.widths[i])-s;e+=Math.abs(this.amplitudes[i]*Math.sin(this.verses[i]*n-this.phases[i])*this.globalAttFn(n))}return e/this.noOfCurves}},{key:"_ypos",value:function(t){return this.AMPLITUDE_FACTOR*this.midLine*this.controller.amplitude*this.yRelativePos(t)*this.globalAttFn(t/this.GRAPH_X*2)}},{key:"_xpos",value:function(t){return this.width*((t+this.GRAPH_X)/(2*this.GRAPH_X))}},{key:"draw",value:function(){var t=this.controller.ctx;if(this.definition.supportLine)return this.drawSupportLine(t,this.definition.color);for(var e=0;e<this.noOfCurves;e++)this.spawnAt+this.despawnTimeouts[e]<=Date.now()?this.amplitudes[e]-=this.DESPAWN_FACTOR:this.amplitudes[e]+=this.DESPAWN_FACTOR,this.amplitudes[e]=Math.min(Math.max(this.amplitudes[e],0),this.finalAmplitudes[e]),this.phases[e]=(this.phases[e]+this.controller.speed*this.speeds[e]*this.SPEED_FACTOR)%(2*Math.PI);for(var i=-1/0,s=[1,-1],n=0;n<s.length;n++){var r=s[n];t.beginPath();for(var o=-this.GRAPH_X;o<=this.GRAPH_X;o+=this.pixelDepth){var a=this._xpos(o),h=this._ypos(o);t.lineTo(a,this.midLine-r*h),i=Math.max(i,h)}t.closePath(),t.fillStyle="rgba(".concat(this.definition.color,", .5)"),t.strokeStyle="rgba(".concat(this.definition.color,", .5)"),t.fill()}i<this.DEAD_PX&&this.prevMaxY>i&&this.respawn(),this.prevMaxY=i}},{key:"drawSupportLine",value:function(t,e){var i=[this.xOffset,0,this.width+this.xOffset,0],s=t.createLinearGradient.apply(t,i);s.addColorStop(0,"transparent"),s.addColorStop(.1,"rgba(".concat(e,", 1)")),s.addColorStop(.9,"rgba(".concat(e,", 1)")),s.addColorStop(1,"transparent"),t.fillStyle=s,t.fillRect.apply(t,[this.xOffset,this.midLine,this.width,1])}}],[{key:"getDefinition",value:function(t){return Object.assign([{color:"255,255,255",supportLine:!0},{color:"15, 82, 169"},{color:"173, 57, 76"},{color:"48, 220, 155"}],t)}}]),e}(),A=function(){function c(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(d(this,c),!t.canvas)throw new Error("Canvas is required");if(this.canvas=t.canvas,this.opt=Object.assign({style:"ios",ratio:1,speed:.2,amplitude:1,frequency:6,color:"#fff",cover:!1,xOffset:0,yOffset:0,width:this.canvas.width,height:this.canvas.height,autostart:!1,pixelDepth:.02,lerpSpeed:.1},t),this.phase=0,this.run=!1,this.speed=Number(this.opt.speed),this.amplitude=Number(this.opt.amplitude),this.xOffset=Number(this.opt.xOffset),this.yOffset=Number(this.opt.yOffset),this.width=Number(this.opt.ratio*this.opt.width),this.height=Number(this.opt.ratio*this.opt.height),this.color="rgb(".concat(this.hex2rgb(this.opt.color),")"),this.interpolation={speed:this.speed,amplitude:this.amplitude},this.ctx=this.canvas.getContext("2d"),this.curves=[],"ios9"===this.opt.style){var e=!0,i=!1,s=void 0;try{for(var n,r=w.getDefinition(this.opt.waveColors||[])[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var o=n.value;this.curves.push(new w({ctrl:this,definition:o,pixelDepth:this.opt.pixelDepth}))}}catch(t){i=!0,s=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw s}}}else{var a=!0,h=!1,l=void 0;try{for(var u,f=Curve.getDefinition()[Symbol.iterator]();!(a=(u=f.next()).done);a=!0){var p=u.value;this.curves.push(new Curve({ctrl:this,definition:p}))}}catch(t){h=!0,l=t}finally{try{a||null==f.return||f.return()}finally{if(h)throw l}}}t.autostart&&this.start()}return i(c,[{key:"hex2rgb",value:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,s){return e+e+i+i+s+s});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?"".concat(parseInt(e[1],16).toString(),",").concat(parseInt(e[2],16).toString(),",").concat(parseInt(e[3],16).toString()):null}},{key:"lerpProp",value:function(t){return this[t]=m(this[t],this.interpolation[t],this.opt.lerpSpeed),this[t]-this.interpolation[t]==0&&(this.interpolation[t]=null),this[t]}},{key:"_clear",value:function(){this.ctx.globalCompositeOperation="destination-out",this.ctx.fillRect(this.xOffset,this.yOffset,this.width,this.height),this.ctx.globalCompositeOperation="source-over"}},{key:"drawFrame",value:function(t){(t||0===t)&&this.setAmplitude(t);var e=!0,i=!1,s=void 0;try{for(var n,r=this.curves[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){n.value.draw()}}catch(t){i=!0,s=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw s}}}},{key:"startDrawCycle",value:function(){!1!==this.run&&(this._clear(),null!==this.interpolation.amplitude&&this.lerpProp("amplitude"),null!==this.interpolation.speed&&this.lerpProp("speed"),this.drawFrame(),this.phase=(this.phase+Math.PI/2*this.speed)%(2*Math.PI),y(this.startDrawCycle.bind(this)))}},{key:"start",value:function(){this.phase=0,this.run=!0,this.startDrawCycle()}},{key:"stop",value:function(){this.phase=0,this.run=!1}},{key:"set",value:function(t,e){this.interpolation[t]=Number(e)}},{key:"setSpeed",value:function(t){this.set("speed",t)}},{key:"setAmplitude",value:function(t){this.set("amplitude",t)}}]),c}();t.Siriwave=A,Object.defineProperty(t,"__esModule",{value:!0})});
