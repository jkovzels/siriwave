!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e(t.Siriwave={})}(this,function(t){"use strict";function v(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var i=0;i<e.length;i++){var n=e[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function i(t,e,i){return e&&n(t.prototype,e),i&&n(t,i),t}var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};for(var s,r=(function(a){(function(){var t,e,i,n,s,r;"undefined"!=typeof performance&&null!==performance&&performance.now?a.exports=function(){return performance.now()}:"undefined"!=typeof process&&null!==process&&process.hrtime?(a.exports=function(){return(t()-s)/1e6},e=process.hrtime,n=(t=function(){var t;return 1e9*(t=e())[0]+t[1]})(),r=1e9*process.uptime(),s=n-r):i=Date.now?(a.exports=function(){return Date.now()-i},Date.now()):(a.exports=function(){return(new Date).getTime()-i},(new Date).getTime())}).call(e)}(s={exports:{}},s.exports),s.exports),a="undefined"==typeof window?e:window,h=["moz","webkit"],o="AnimationFrame",u=a["request"+o],l=a["cancel"+o]||a["cancelRequest"+o],f=0;!u&&f<h.length;f++)u=a[h[f]+"Request"+o],l=a[h[f]+"Cancel"+o]||a[h[f]+"CancelRequest"+o];if(!u||!l){var c=0,d=0,p=[];u=function(t){if(0===p.length){var e=r(),i=Math.max(0,1e3/60-(e-c));c=i+e,setTimeout(function(){for(var t=p.slice(0),e=p.length=0;e<t.length;e++)if(!t[e].cancelled)try{t[e].callback(c)}catch(t){setTimeout(function(){throw t},0)}},Math.round(i))}return p.push({handle:++d,callback:t,cancelled:!1}),d},l=function(t){for(var e=0;e<p.length;e++)p[e].handle===t&&(p[e].cancelled=!0)}}var y=function(t){return u.call(a,t)};y.cancel=function(){l.apply(a,arguments)},y.polyfill=function(t){t||(t=a),t.requestAnimationFrame=u,t.cancelAnimationFrame=l};var w=function(){function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};v(this,e),this.ctx=t.ctx,this.speed=t.speed,this.xOffset=t.xOffset,this.yOffset=t.yOffset,this.height=t.height,this.width=t.width,this.midLine=this.yOffset+this.height/2,this.definition=t.definition,this.resolution=t.resolution,this.GRAPH_X=25,this.SPEED_FACTOR=1,this.DEAD_PX=2,this.ATT_FACTOR=4,this.DESPAWN_SPEED=.02,this.respawn()}return i(e,[{key:"getRandom",value:function(t,e){var i=0;return Array.isArray(t)?(i=t[0],e=t[1]):i=t,Math.random()*(e-i)+i}},{key:"getRandomInt",value:function(t,e){var i=0;return Array.isArray(t)?(i=t[0],e=t[1]):i=t,i=Math.ceil(i),e=Math.floor(e),Math.floor(Math.random()*(e-i+1))+i}},{key:"respawnSingle",value:function(t){this.phases[t]=0,this.amplitudes[t]=0,this.despawnSteps[t]=this.getRandom(60,180),this.offsets[t]=this.getRandom(Math.round(-12/this.curveCount),Math.round(12/this.curveCount)),this.speeds[t]=this.getRandom(.5,1),this.finalAmplitudes[t]=this.getRandom(.4,1),this.widths[t]=this.getRandom(1,4),this.ripples[t]=this.getRandom(0,0)}},{key:"respawn",value:function(){this.step=0,this.curveCount=this.getRandomInt(this.definition.curveCountRange),this.phases=new Array(this.curveCount),this.offsets=new Array(this.curveCount),this.speeds=new Array(this.curveCount),this.finalAmplitudes=new Array(this.curveCount),this.widths=new Array(this.curveCount),this.amplitudes=new Array(this.curveCount),this.despawnSteps=new Array(this.curveCount),this.ripples=new Array(this.curveCount);for(var t=0;t<this.curveCount;t++)this.respawnSingle(t)}},{key:"globalAttFn",value:function(t){return Math.pow(this.ATT_FACTOR/(this.ATT_FACTOR+Math.pow(t,2)),this.ATT_FACTOR)}},{key:"yRelativePos",value:function(t){for(var e=0,i=0;i<this.curveCount;i++){var n=1==this.curveCount?2:4*(i/(this.curveCount-1)*2-1);n+=this.offsets[i];var s=t*(1/this.widths[i])-n;e+=Math.abs(this.amplitudes[i]*Math.sin(this.ripples[i]*s-this.phases[i])*this.globalAttFn(s))}return e/this.curveCount}},{key:"ypos",value:function(t){return this.height*this.masterAmplitude*this.yRelativePos(t)*this.globalAttFn(t/this.GRAPH_X*2)}},{key:"xpos",value:function(t){return this.width*((t+this.GRAPH_X)/(2*this.GRAPH_X))+this.xOffset}},{key:"draw",value:function(t){this.masterAmplitude=t;var e=this.ctx;if(this.definition.throughline)this.drawThroughline(e,this.definition);else{this.spawnDespawn();for(var i=this.width/2+this.xOffset,n=-1/0,s=[],r=[],a=-this.GRAPH_X;a<=this.GRAPH_X;a+=this.resolution){var h=this.xpos(a);r.push(h);var o=this.ypos(a);n<o&&(n=o,i=h),s.push(o)}var u=this.height/2;if(u<n){for(var l=0;l<s.length;l++)s[l]=s[l]/u;n/=u}e.beginPath(),e.moveTo(r[0],this.midLine);for(var f=0;f<s.length;f++)e.lineTo(r[f],this.midLine-s[f]);for(var c=s.length-1;0<=c;c--)e.lineTo(r[c],this.midLine+s[c]*this.definition.mirrorFactor);e.closePath();var d=i,p=this.midLine,v=n,y=e.createRadialGradient(d,p,.8*v,d,p,.4*v);y.addColorStop(0,"rgba(".concat(this.definition.rgb.join(),", ").concat(this.definition.alphaStart,")")),y.addColorStop(1,"rgba(".concat(this.definition.rgb.join(),", ").concat(this.definition.alphaEnd,")")),e.fillStyle=y,e.fill(),n<this.DEAD_PX&&this.prevMaxY>n&&this.respawn(),this.prevMaxY=n}}},{key:"spawnDespawn",value:function(){this.step++;for(var t=0;t<this.curveCount;t++)this.despawnSteps[t]<=this.step?this.amplitudes[t]-=this.DESPAWN_SPEED:this.amplitudes[t]+=this.DESPAWN_SPEED,this.amplitudes[t]=Math.min(Math.max(this.amplitudes[t],0),this.finalAmplitudes[t]),this.phases[t]=(this.phases[t]+this.speed*this.speeds[t]*this.SPEED_FACTOR)%(2*Math.PI)}},{key:"drawThroughline",value:function(t,e){var i=[this.xOffset,0,this.width+this.xOffset,0],n=t.createLinearGradient.apply(t,i);n.addColorStop(0,"transparent"),n.addColorStop(.1,"rgba(".concat(e.rgb.join(),", ").concat(e.alphaStart,"})")),n.addColorStop(.9,"rgba(".concat(e.rgb,", ").concat(e.alphaStart,")")),n.addColorStop(1,"transparent"),t.fillStyle=n,t.fillRect.apply(t,[this.xOffset,this.midLine,this.width,1])}}],[{key:"getDefinitions",value:function(t){if(!t||0==t.length)return[{rgb:"255,255,255",alphaStart:1,alphaEnd:1,throughline:!0},{rgb:[15,82,169],alphaStart:.5,alphaEnd:.2},{rgb:[173,57,76],alphaStart:.5,alphaEnd:.2},{color:[48,220,155],alphaStart:.5,alphaEnd:.2}];for(var e=0;e<t.length;e++){var i=t[e];i=Object.assign({alphaStart:.5,alphaEnd:.2,mirrorFactor:1,curveCountRange:[1,1]},i),t[e]=i}return t}}]),e}(),g=function(){function p(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(v(this,p),!t.canvas)throw new Error("Canvas is required");if(this.canvas=t.canvas,this.opt=Object.assign({style:"ios",speed:.2,amplitude:1,frequency:6,color:"#fff",cover:!1,xOffset:0,yOffset:0,width:this.canvas.width,height:this.canvas.height,autostart:!1,resolution:.02},t),this.run=!1,this.speed=Number(this.opt.speed),this.amplitude=Number(this.opt.amplitude),this.xOffset=Number(this.opt.xOffset),this.yOffset=Number(this.opt.yOffset),this.width=Number(this.opt.width),this.height=Number(this.opt.height),this.color=this.opt.color,this.ctx=this.canvas.getContext("2d"),this.curves=[],"ios9"===this.opt.style){var e=w.getDefinitions(this.opt.curveDefinitions),i=!0,n=!1,s=void 0;try{for(var r,a=e[Symbol.iterator]();!(i=(r=a.next()).done);i=!0){var h=r.value;this.curves.push(new w({ctx:this.ctx,definition:h,speed:t.speed,resolution:t.resolution,xOffset:t.xOffset,yOffset:t.yOffset,height:t.height,width:t.width}))}}catch(t){n=!0,s=t}finally{try{i||null==a.return||a.return()}finally{if(n)throw s}}}else{var o=!0,u=!1,l=void 0;try{for(var f,c=Curve.getDefinition()[Symbol.iterator]();!(o=(f=c.next()).done);o=!0){var d=f.value;this.curves.push(new Curve({ctrl:this,definition:d}))}}catch(t){u=!0,l=t}finally{try{o||null==c.return||c.return()}finally{if(u)throw l}}}t.autostart&&this.start()}return i(p,[{key:"hex2rgb",value:function(t){t=t.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,function(t,e,i,n){return e+e+i+i+n+n});var e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?"".concat(parseInt(e[1],16).toString(),",").concat(parseInt(e[2],16).toString(),",").concat(parseInt(e[3],16).toString()):null}},{key:"clear",value:function(){this.color&&(this.ctx.fillStyle=this.color,this.ctx.fillRect(this.xOffset,this.yOffset,this.width,this.height))}},{key:"drawFrame",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0;this.clear();var e=!0,i=!1,n=void 0;try{for(var s,r=this.curves[Symbol.iterator]();!(e=(s=r.next()).done);e=!0){s.value.draw(t)}}catch(t){i=!0,n=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw n}}}},{key:"startDrawCycle",value:function(){!1!==this.run&&(this.drawFrame(1),y(this.startDrawCycle.bind(this)))}},{key:"start",value:function(){this.run=!0,this.startDrawCycle()}},{key:"stop",value:function(){this.run=!1}}]),p}();t.Siriwave=g,Object.defineProperty(t,"__esModule",{value:!0})});
